<link rel="import" href="../polymer/polymer.html">
<script>
(function() {
	'use strict';

	/** @polymerBehavior */
	var MenuItemBehavior = {

		hostAttributes: {
			'role': 'menuitem',
			tabindex: -1
		},

		listeners: {
			'blur': '_onBlur',
			'focus': '_onFocus',
			'hide-complete': '_onHideComplete',
			'keydown': '_onKeyDown',
			'mouseenter': '_onMouseEnter',
			'mouseleave': '_onMouseLeave',
			'tap': '_onTap'
		},

		properties: {
			disabled: {
				type: Boolean,
				reflectToAttribute: true,
				value: false
			},
			hasChildView: {
				type: Boolean,
				value: false
			},
			text: String
		},

		_keyCodes: {
			ENTER: 13,
			LEFT: 37,
			RIGHT: 39,
			SPACE: 32
		},

		_children: null,

		ready: function() {
			var children = this.getEffectiveChildren();
			if (children && children.length > 0) {
				this.hasChildView = true;
				this._children = children;
				this.setAttribute('aria-haspopup', true);
				// assumption: single, focusable child view
				this._children[0].setAttribute('label', this.text);
			}
		},

		_action: function() {

			if (this.disabled) {
				return;
			}

			if (this._children && this._children.length > 0 && this._children[0].isHierarchicalView) {
				// assumption: single, focusable child view
				this._children[0].show();
			} else {
				this.fire('select');
			}

		},

		_onBlur: function() {
			this.fire('_blur');
		},

		_onFocus: function() {
			this.fire('_focus');
		},

		_onHideComplete: function(e) {
			if (this._children.indexOf(Polymer.dom(e).localTarget) === -1) {
				return;
			}
			this.focus();
		},

		_onKeyDown: function(e) {
			if (e.keyCode === this._keyCodes.ENTER || e.keyCode === this._keyCodes.SPACE) {
				e.stopPropagation();
				this._action();
				return;
			}
			if (this._children && this._children.length > 0 && e.keyCode === this._keyCodes.RIGHT) {
				e.stopPropagation();
				this._action();
				return;
			}
		},

		_onMouseEnter: function() {
			this.fire('_mouseenter');
		},

		_onMouseLeave: function() {
			this.fire('_mouseleave');
		},

		_onTap: function(e) {
			e.stopPropagation();
			this._action();
		}

	};

	window.D2L = window.D2L || {};
	window.D2L.PolymerBehaviors = window.D2L.PolymerBehaviors || {};
	/** @polymerBehavior */
	window.D2L.PolymerBehaviors.MenuItemBehavior = [MenuItemBehavior];
})();
</script>
