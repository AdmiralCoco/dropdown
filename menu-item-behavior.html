<link rel="import" href="../polymer/polymer.html">
<script>
(function() {
	'use strict';

	/** @polymerBehavior */
	var MenuItemBehavior = {

		hostAttributes: {
			'role': 'menuitem',
			tabindex: -1
		},

		listeners: {
			'_sub-view-hidden': '_handleSubViewHidden',
			'blur': '_handleBlur',
			'focus': '_handleFocus',
			'keyup': '_handleKeyUp',
			'mouseenter': '_handleMouseEnter',
			'mouseleave': '_handleMouseLeave',
			'tap': '_handleTap'
		},

		properties: {
			disabled: {
				type: Boolean,
				reflectToAttribute: true,
				value: false
			},
			text: String
		},

		_keyCodes: {
			ENTER: 13,
			LEFT: 37,
			RIGHT: 39,
			SPACE: 32
		},

		_children: null,

		ready: function() {
			var children = this.getEffectiveChildren();
			if (children && children.length > 0) {
				this._children = children;
				this.setAttribute('aria-haspopup', true);
				// assumption: single, focusable child view
				this._children[0].setAttribute('label', this.text);
				this._children[0].setAttribute('sub-view', true);
			}
		},

		_action: function() {

			if (this.disabled) {
				return;
			}

			if (this._children && this._children.length > 0) {
				//this.setAttribute('sub-view-displayed', true);
				this.setAttribute('sub-view-displayed', true);
				this.fire('_sub-view-displayed');
				// assumption: single, focusable child view
				this._children[0].focus();
			} else {
				this.fire('select');
			}

		},

		_handleBlur: function(e) {
			this.fire('_blur');
		},

		_handleFocus: function(e) {
			this.fire('_focus');
		},

		_handleSubViewHidden: function(e) {
			//if (e.target === this) {
			//	return;
			//}
			//this.removeAttribute('show-sub-menu');
			if (e.target === this) {
				return;
			}
			this.removeAttribute('sub-view-displayed');
		},

		_handleKeyUp: function(e) {
			if (e.keyCode === this._keyCodes.ENTER || e.keyCode === this._keyCodes.SPACE) {
				e.stopPropagation();
				this._action();
				return;
			}
			if (this._children && this._children.length > 0 && e.keyCode === this._keyCodes.RIGHT) {
				e.stopPropagation();
				this._action();
				return;
			}
		},

		_handleMouseEnter: function(e) {
			this.fire('_mouseenter');
		},

		_handleMouseLeave: function(e) {
			this.fire('_mouseleave');
		},

		_handleTap: function(e) {
			e.stopPropagation();
			this._action();
		}

	};

	window.D2L = window.D2L || {};
	window.D2L.PolymerBehaviors = window.D2L.PolymerBehaviors || {};
	/** @polymerBehavior */
	window.D2L.PolymerBehaviors.MenuItemBehavior = [MenuItemBehavior];
})();
</script>
