<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="dropdown-styles.html">
<link rel="import" href="dropdown-behavior.html">
<link rel="import" href="d2l-menu.html">

<dom-module id="d2l-dropdown-menu">

	<template>
		<style include="d2l-colors d2l-dropdown-styles"></style>
		<style>

			:host {
				min-width: 3.5rem;
			}

			:host .d2l-dropdown-container {
				border-style: none;
			}

			:host .d2l-dropdown-pointer {
				top: -7px;
			}

			:host .d2l-dropdown-flip-x > .d2l-dropdown-pointer {
				bottom: -8px;
			}

			:host .d2l-dropdown-menu-item-first-hover > .d2l-dropdown-pointer > div,
			:host .d2l-dropdown-menu-item-first-focus > .d2l-dropdown-pointer > div {
				background-color: var(--d2l-color-celestine-light-1);
				border-color: var(--d2l-color-celestine-light-2);
			}

			:host .d2l-dropdown-flip-x.d2l-dropdown-menu-item-first-hover > .d2l-dropdown-pointer > div,
			:host .d2l-dropdown-flip-x.d2l-dropdown-menu-item-first-focus > .d2l-dropdown-pointer > div {
				background-color: var(--d2l-color-white);
				border-color: var(--d2l-color-titanius);
			}

			:host .d2l-dropdown-flip-x.d2l-dropdown-menu-item-last-hover > .d2l-dropdown-pointer > div,
			:host .d2l-dropdown-flip-x.d2l-dropdown-menu-item-last-focus > .d2l-dropdown-pointer > div {
				background-color: var(--d2l-color-celestine-light-1);
				border-color: var(--d2l-color-celestine-light-2);
			}

		</style>
		<div class="d2l-dropdown-container">
			<div class="d2l-dropdown-pointer">
				<div></div>
			</div>
			<div class="d2l-dropdown-content-container">
				<content></content>
			</div>
		</div>
	</template>

	<script>
		Polymer({
			is: 'd2l-dropdown-menu',

			behaviors: [
				window.D2L.PolymerBehaviors.DropdownBehavior
			],

			listeners: {
				'_first-blur': '_onFirstMenuItemBlur',
				'_last-blur': '_onLastMenuItemBlur',
				'_first-focus': '_onFirstMenuItemFocus',
				'_last-focus': '_onLastMenuItemFocus',
				'_first-mouseenter': '_onFirstMenuItemMouseEnter',
				'_last-mouseenter': '_onLastMenuItemMouseEnter',
				'_first-mouseleave': '_onFirstMenuItemMouseLeave',
				'_last-mouseleave': '_onLastMenuItemMouseLeave',
				'close': '_onClose',
				'open': '_onOpen',
				'select': '_onSelect'
			},

			ready: function() {
				this.noAutoFit = true;
				this.__container = this.$$('.d2l-dropdown-container');
			},

			_onFirstMenuItemBlur: function() {
				this.__container.classList.remove('d2l-dropdown-menu-item-first-focus');
			},

			_onLastMenuItemBlur: function() {
				this.__container.classList.remove('d2l-dropdown-menu-item-last-focus');
			},

			_onFirstMenuItemFocus: function() {
				this.__container.classList.add('d2l-dropdown-menu-item-first-focus');
			},

			_onLastMenuItemFocus: function() {
				this.__container.classList.add('d2l-dropdown-menu-item-last-focus');
			},

			_onFirstMenuItemMouseEnter: function() {
				this.__container.classList.add('d2l-dropdown-menu-item-first-hover');
			},

			_onLastMenuItemMouseEnter: function() {
				this.__container.classList.add('d2l-dropdown-menu-item-last-hover');
			},

			_onFirstMenuItemMouseLeave: function() {
				this.__container.classList.remove('d2l-dropdown-menu-item-first-hover');
			},

			_onLastMenuItemMouseLeave: function() {
				this.__container.classList.remove('d2l-dropdown-menu-item-last-hover');
			},

			_onClose: function(e) {

				if (e.target !== this) {
					return;
				}

				// reset to root view
				var menu = this.queryEffectiveChildren('[role="menu"]');
				menu.show({ preventFocus: true });

			},

			_onOpen: function(e) {

				if (e.target !== this) {
					return;
				}

				var menu = this.queryEffectiveChildren('[role="menu"]');
				menu.resize();

				setTimeout(function() {
					menu.focus();
				}, 0);

			},

			_onSelect: function(e) {
				if (e.target.tagName !== 'D2L-MENU-ITEM') {
					return;
				}
				this.close();
			}

		});
	</script>

</dom-module>
