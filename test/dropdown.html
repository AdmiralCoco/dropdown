<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>d2l-dropdown basic tests</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
		<script src="../../web-component-tester/browser.js"></script>
		<link rel="import" href="../d2l-dropdown.html">
	</head>
	<body>
		<button id="opener">opener</button>

		<test-fixture id="Dropdown">
			<template>
				<d2l-dropdown id="dropdown" target-id="opener">
					<p>Lorem ipsum dolor sit...</p>
					<a id="dropdownLink" href="http://www.google.com">Google 1</a>
				</d2l-dropdown>
				<a id="otherLink" href="http://www.google.com">Google 2</a>
			</template>
		</test-fixture>
		<script>

		describe('<d2l-dropdown>', function() {

			var dropdown, dropdownLink, otherLink;

			beforeEach(function() {
				fixture('Dropdown');
				dropdown = document.getElementById('dropdown');
				dropdownLink = document.getElementById('dropdownLink');
				otherLink = document.getElementById('otherLink');
			});

			it('distributes its children', function() {
				var content = dropdown.getContentChildren();
				expect(content.length).to.equal(2);
				expect(content[0]).to.equal(dropdown.querySelector('p'));
			});

			it('should fire open event when open attribute is added', function(done) {
				dropdown.addEventListener('open', function() {
					expect(dropdown.opened).to.be.true;
					done();
				});
				dropdown.setAttribute('opened', true);
			});


			it('should fire close event when open attribute is removed', function(done) {
				dropdown.addEventListener('open', function() {
					dropdown.removeAttribute('opened');
				});
				dropdown.addEventListener('close', function() {
					expect(dropdown.opened).to.be.false;
					done();
				});
				dropdown.setAttribute('opened', true);
			});

			it('should close when focus lost and auto-close is specified', function(done) {
				dropdown.addEventListener('open', function() {
					dropdownLink.focus();
					otherLink.focus();
				});
				dropdown.addEventListener('close', function() {
					expect(dropdown.opened).to.be.false;
					done();
				});
				dropdown.setAttribute('opened', true);
			});

			it('should not close when focus lost and auto-close is not specified', function(done) {
				dropdown.addEventListener('open', function() {
					dropdownLink.focus();
					otherLink.focus();
					setTimeout(function() {
						expect(dropdown.opened).to.be.true;
						done();
					},100);
				});
				dropdown.setAttribute('no-auto-close', true);
				dropdown.setAttribute('opened', true);
			});

		});
		</script>
	</body>
</html>
